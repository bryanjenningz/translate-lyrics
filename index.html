<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>
    <div id="english-lyrics"></div>
    <div id="japanese-lyrics"></div>

    <script>
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: 'XVyHQqhP5gY',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
        stopLyricsInterval = setInterval(displayCurrentLyrics, 100);
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;
      function onPlayerStateChange(event) {
        // if (event.data == YT.PlayerState.PLAYING && !done) {
        //   setTimeout(stopVideo, 10000);
        //   done = true;
        // }
      }
      function stopVideo() {
        player.stopVideo();
      }


      var url = "https://www.youtube.com/watch?v=XVyHQqhP5gY";

      var timeToLyrics = {
        "0": ["もー、会えないんだな。", "Guess I won’t ever see you again."],
        "17": ["嘘みたいだな。", "This can’t be happening."],
        "21": ["眠り方も忘れたみたい。", "It’s like I’ve forgotten how to sleep as well."],
        "26": ["いずれにせよ、夢の外だ。", "In any case, this isn’t a dream."],
        "32": ["君がいないんじゃなぁ。", "If you’re not here."],
        "37": ["あー、恋しくなる。", "Ah, I need you."],
        "40": ["苦しくなる。", "I’m hurting."],
        "43": ["どうにかなる。", "Something’s happening to me."],
        "46": ["触れない距離、", "The distance that prevents us from touching"],
        "49": ["積もる月日、", "And the passing days that pile up"],
        "52": ["それらがいま、二人を離していくところ。", "Are where we’re being separated."],
        "60": ["悲しみコードは爆音です。", "Grief is the roar of explosions."],
        "66": ["君の声も聞こえない、届かない。", "I can't even hear your voice, it doesn't reach me."],
        "75": ["ざわめく風が薫る、るる ―。", "The wind is so noisy, so fragrant... ruru"],
        "82": ["アローンアゲイン 頼りない世界。", "Alone again, Unreliable world."],
        "87": ["グルグル、いつまでも回る。", "Round and round, spinning for eternity."],
        "93": ["うずまく心は七色。", "My swirling heart’s a rainbow."],
        "98": ["また会えるのかな？", "Will we meet again?"],
        "102": ["ハロー、ハロー、届いたなら", "Hello, hello, I call, if my words reach you"],
        "109": ["悪戯にワンダフルワールド。", "Mischievous wonderful world."],
        "118": ["ねー、四六時中、思い出して名前を呼ぶ。", "Hey, all day I remember, and call out your name. "],
        "128": ["こだましていく。", "It only keeps on echoing."],
        "131": ["真昼の月。", "Midday moon."],
        "134": ["ひとつしかない答えが浮かんでて消えそう。", "A single answer floats about, like it might disappear."],
        "142": ["切なさモードの残像です。", "A remnant of the painful mode."],
        "148": ["君の顔も見えない、わからない。", "I can’t even see your face, can’t recognize it."],
        "157": ["ざわめく風が笑う、ふふ ―。", "The rustling wind laughs, fufu——."],
        "164": ["スカートの翼を広げて", "Spread those skirt-like wings "],
        "169": ["ユラユラ、君、夢、幻。", "And slowly sway; you, a dream, an illusion. "],
        "175": ["うるさい涙が散らかる。", "Annoying tears scatter in disorder"],
        "181": ["まだ探せるなら、", "If I can still find you"],
        "185": ["ハロー、ハロー、何処にいるの？", "Hello, hello where are you?"],
        "202": ["意地悪なワンダフルワールド。", "Cruel, wonderful world"],
        "212": ["哀愁ナラ今日モ更新終了", "Sorrow, today I'll stop its renewal"],
        "221": ["感傷ナラ明日モ申請中", "Sentiment, I'll apply for it tomorrow."],
        "232": ["あー、未来とかは手探りでも、あたらしい日々。", "Ah, even if the future is nothing but fumbling, at least it’ll be a new day."],
        "242": ["ばかみたいだなー。", "I must look like a fool."],
        "245": ["涙の向こう、君はなんて僕を叱るんだろう？", "Beyond my tears, what are you saying to scold me?"],
        "255": ["アローンアゲイン", "Alone again"],
        "258": ["頼りない世界。", "Unreliable world."],
        "261": ["グルグル、いつまで回るの？", "Round and round, how long will it spin?"],
        "266": ["うずまく心は七色。", "My swirling heart’s a rainbow."],
        "272": ["想い出で間違い探しだ！", "I'll find the mistakes in my memory!"],
        "278": ["スカートの翼を広げて", "I'll spread skirt-like wings"],
        "284": ["ヒラヒラ、君、夢、幻。", "flutter; you, a dream, an illusion"],
        "289": ["うるさい涙が散らかる。", "Annoying tears fall in disorder."],
        "295": ["まだ探せるかな？ハロー、ハロー、", "If I can still find you, I'll say Hello, hello"],
        "303": ["何処かにいる君と僕、", "To you and me, somewhere"],
        "309": ["ワンダフルワールド。", "In this wonderful world."]
      };

      var englishLyricsEl = document.getElementById('english-lyrics');
      var japaneseLyricsEl = document.getElementById('japanese-lyrics');
      var stopLyricsInterval;

      function displayCurrentLyrics() {
        var lastLyricsTime = Math.floor(player.getCurrentTime());
        while (!timeToLyrics[lastLyricsTime] && lastLyricsTime > 0) {
          lastLyricsTime--;
        }
        japaneseLyricsEl.textContent = timeToLyrics[lastLyricsTime][0];
        englishLyricsEl.textContent = timeToLyrics[lastLyricsTime][1];
      }

    </script>
  </body>
</html>
